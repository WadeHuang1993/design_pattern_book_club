# 第 1 章 引言

### 設計模式的作用是什麼？

設計物件導軟體向比較困難，而設計可複用的物件導向程式就更加困難：

- 程式的粒度
- 程式的歸類
- 介面和繼承的關係
- 物件之間的關係
- 同時對將來隨時間衍生的需求也要有足夠的通用性


有經驗的物件導向設計者會告訴你，
要一下子就得到復用性和靈活性好設計，並非不可能，但至少也是非常困難的。
**一個設計在最終完成之前常要被復用好幾次，而且每一次都有所修改。**

有經驗的開發人員設計者知道不是解決任何問題都要從頭做起，
他們更願意使用以前使用過的解決方案（設計）。

一個好的解決方案會被一遍又一遍地使用，
因此你會在許多物件導向系統中看到**物件之間重複出現的協作模式**。

這些設計模式解決了特定的設計問題，使物件導向更容易擴展、閱讀、維護。

## 到處都有模式

小說家很少從頭開始設計劇情，總是沿襲已經存在的模式，例如：

- 悲劇性英雄模式
- 浪漫小說模式

同樣地，開發人員也沿襲了一些模式，例如：

- 使用物件來表達資料的狀態
- 設計物件的公開方法，維護資料（添加/刪除屬性）

這本書的目的就是將面向對象軟件的設計經驗作為設計式記錄下來，
替每一個設計模式系統地命名、解釋、分類。

設計模式使人們可以更加容易地複用成功的設計和結構。
**將已證實的技術表述成設計模式，也會使新系統開發者更加容易理解其設計思路**

```
例如：
Cache 快取、隊列 Queue、前端的 Lazy Loading
```

書中討論的設計式僅僅包含一些物件導向的模式。
書中沒有討論與分布式系統、即時系統相關的設計模式，也沒有收錄特定領域的模式。
所以本書不會教你怎麼打造 UI 介面，怎麼寫設備驅動程式，或怎麼使用資料庫。
每個領域都有自己的模式，將這些模式分類編目也是相當有意義的事情。

```
備註：
不是只有物件導向才有設計模式，
事實上，到處都有設計模式
而這本書提到的模式並非只能透過物件導向來實現。

希望各位閱讀這本書時，不要緊抓著每一個模式的「實作內容」不放。

焦點放在每一個模式的「實作內容」很容易使你在學習設計模式中撞牆，
因為一個模式在不同的場景下，就可能有不同的實作內容跟方法，
唯一不會變動的事每一個模式的「意圖」，包含：
  - 想解決什麼問題
  - 基本原理是什麼
```

## 1.1 什麼是設計模式

Christopher Alexander 說過:
> “ 每一個模式描述了一個在我們周圍不斷重複發生的問題，以及該問題的解決方案的核心。
> 這樣，你就能一次又一次地使用該方案而不必做重複勞動 “

儘管 Alexander 所指的是城市和建築模式，但他的思想也同樣適用於物件導向設計模式，
只在物件導向的解決方案裡，我們用物件和介面代替了牆壁和門窗。

一般而言，一個模式有四個基本要素:

1. 模式名稱 (pattem name)
一個助記名，允許我們在較高的抽象層次上進行其他人交流。

2. 問題 (problem)
解釋了設計問題和問題存在的前因後果，
它可能描述了特定的設計問題，如怎樣使用物件表示演算法等、
也可能描述了**導致不靈活設計**的程式結構。

3. 解決方案 (solution)
描述了設計的組成成分，以及它們之間的**互相關係**及**各自的職責**和**協作方式**。
因為模式就像一個範本，可應用於種不同場合，
所以**解決方案並不描述一個特定而具體的設計或實現**，
**而提供設計問題的抽象描述，和怎樣用具有意義的元素組合來解決問題**。

4. 效果 (consequences)
描述了模式的效果與 **權衡**。
引入每一個模式都有成本，增加一些理解的複雜度，
以換取對系統的「靈活性、擴充性或可移植性」，
使用模式之前，慎重考慮上述這些影響與權衡將會很有幫助。

## 1.2 MVC 模式

https://imgur.com/a/f72DLcz

MVC 通過建立一個 “訂閱/通知” 結構來分離**視圖（View）**和**模型（Model）**。
**視圖** 必須保證它的顯示正確地反映了 **模型** 的狀態。
一旦模型的數據發生變化模型將通知有關的視圖，每個視圖將得到更新自己的機會。
這種方法可以讓你為一個**模型**提供**多個不同的視圖**表現形式，也能夠在**創建新的視圖而無須重寫模型**。

## 1.3 描述設計模式

我們怎樣描述設計模式呢？
**圖形符號雖然很重要也很有用，卻還遠遠不夠**，
它們只是將設計過程的結果簡單記錄為類和對象之間的關係。

為了達到設計復用，
我們**必須同時記錄設計產生的決定過程、選擇過程和權衡過程**，
具體的例子也是很重要的，它們讓你看到實際的設計。

範例：
原本使用的第三方信件服務開始收費了，為了節省使用寄信費用支出，故在送出信件前檢查信件格式。

這個範例紀錄了 **一個功能會在不同的時空背景下有不同的需求規格**，
我們有責任記錄下為什麼要在某個時間點引入模式來解決問題，
讓後續維護的人能理解模式的用意。

commit: 08b65bbfd9b9066af35037aa92e7b335c458fe08
commit: 2e10efea8bcd5915cab69a47aa407b32f90d4236

另外，從這個案例我們也可以觀察到設計模式並非只能應用在「物件層級」，
這個 Proxy 模式其實也是微服務層級的代理模式，
我們透過這個 Proxy 管理了我方服務與 Gmail 服務之間的存取方式。

